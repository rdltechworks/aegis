graph TD
    %% Data & Device Layer
    subgraph DataLayer ["ğŸ”Œ Data & Device Layer"]
        direction TB
        IoT["ğŸ“¡ IoT Devices &<br/>Network Traffic"] 
        Mosquitto["ğŸ“¨ Mosquitto MQTT Broker<br/>(Message Queue)"]
        IoT -.->|"Raw Telemetry"| Mosquitto
    end
    
    %% Aegis Hub Core Platform
    subgraph AegisCore ["ğŸ›¡ï¸ Aegis Hub Core Platform (Python 3.11+)"]
        direction TB
        
        %% Storage Layer
        subgraph Storage ["ğŸ’¾ Data Storage"]
            SQLite["ğŸ—„ï¸ SQLite Database<br/>(Time-Series & Logs)"]
        end
        
        %% Backend Services
        subgraph Backend ["âš™ï¸ Backend Services"]
            FastAPI["ğŸš€ FastAPI Server<br/>(REST API & WebSocket)"]
            SSE["ğŸ“¡ Server-Sent Events<br/>(Real-time Updates)"]
        end
        
        %% Guardian Agent with Google ADK
        subgraph Guardian ["ğŸ¤– Guardian Agent - Google ADK Integration"]
            direction TB
            
            %% Google ADK Core
            subgraph GoogleADK ["ğŸ§  Google Agent Development Kit"]
                ADKCore["ğŸ”§ ADK Runtime Engine"]
                ADKTools["ğŸ› ï¸ ADK Tool Integration"]
            end
            
            %% CAMA Cognitive Loop
            subgraph CAMALoop ["ğŸ”„ CAMA Cognitive Loop"]
                direction LR
                Input["ğŸ“¥ Data Input"] --> Refactor["ğŸ”„ Refactor &<br/>Normalize"]
                Refactor --> Breakdown["ğŸ” Analysis &<br/>Breakdown"]
                Breakdown --> Compile["ğŸ“Š Synthesis &<br/>Compile"]
                Compile --> Output["ğŸ“¤ Actionable<br/>Insights"]
            end
            
            %% Memory Systems
            subgraph MemorySystems ["ğŸ§  Memory Systems"]
                direction TB
                SM["ğŸ“š Semantic Memory<br/>(Domain Knowledge)"]
                WM["âš¡ Working Memory<br/>(Active Context)"]
                PM["ğŸ› ï¸ Procedural Memory<br/>(Tools & Skills)"]
                EM["ğŸ“‹ Episodic Memory<br/>(Incident History)"]
            end
            
            %% ADK Integration
            ADKCore -.->|"Orchestrates"| Input
            ADKTools -.->|"Enhances"| Breakdown
            
            %% Memory Connections
            Refactor -.->|"Leverages"| SM
            Breakdown -.->|"Utilizes"| WM
            Breakdown -.->|"Applies"| PM
            Compile -.->|"Updates"| EM
        end
        
        %% Frontend Layer
        subgraph Frontend ["ğŸ–¥ï¸ Frontend Layer"]
            HTMX["ğŸŒ HTMX Web Interface<br/>(Dynamic UI)"]
            WebDash["ğŸ“Š Security Dashboard<br/>(Real-time Monitoring)"]
            Alerts["ğŸš¨ Alert Management<br/>(Incident Response)"]
        end
        
        %% Container Infrastructure
        subgraph Container ["ğŸ³ Container Infrastructure"]
            Docker["ğŸ³ Docker Containers"]
            Compose["ğŸ“‹ Docker Compose<br/>(Service Orchestration)"]
        end
        
        %% Internal Connections
        Mosquitto ==>|"Message Ingestion"| FastAPI
        FastAPI ==>|"Stores Data"| SQLite
        SQLite ==>|"Queries Data"| Input
        Output ==>|"Triggers"| SSE
        Output ==>|"API Response"| FastAPI
        FastAPI <==>|"Serves"| HTMX
        SSE -.->|"Real-time Updates"| WebDash
        FastAPI -.->|"Alert API"| Alerts
    end
    
    %% User Interaction Layer
    subgraph UserLayer ["ğŸ‘¥ User Interaction Layer"]
        direction TB
        Users["ğŸ‘¤ Security Analysts<br/>& Operators"]
        Mobile["ğŸ“± Mobile Access<br/>(Future Enhancement)"]
    end
    
    %% External Connections
    HTMX <==>|"Interactive Dashboard"| Users
    WebDash <==>|"Real-time Monitoring"| Users
    Alerts -.->|"Notifications"| Users
    
    %% Container Deployment
    Docker -.->|"Containerizes"| FastAPI
    Docker -.->|"Containerizes"| Mosquitto
    Docker -.->|"Containerizes"| SQLite
    Compose -.->|"Orchestrates"| Docker
    
    %% Styling
    classDef dataLayer fill:#e1f5fe,stroke:#0277bd,stroke-width:2px,color:#000
    classDef backendLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef frontendLayer fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,color:#000
    classDef memorySystem fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000
    classDef processLayer fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    classDef userLayer fill:#fff8e1,stroke:#f57c00,stroke-width:2px,color:#000
    classDef alertSystem fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
    classDef containerLayer fill:#f1f8e9,stroke:#689f38,stroke-width:2px,color:#000
    classDef googleADK fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    
    class IoT,Mosquitto dataLayer
    class FastAPI,SSE,SQLite backendLayer
    class HTMX,WebDash frontendLayer
    class SM,WM,PM,EM memorySystem
    class Input,Refactor,Breakdown,Compile,Output processLayer
    class Users,Mobile userLayer
    class Alerts alertSystem
    class Docker,Compose containerLayer
    class ADKCore,ADKTools googleADK